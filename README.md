Nomad 触ってみた

-----

## なんぞこれ

「サーバ管理用エージェント」

ジョブを設定ファイルで定義して、それに従ってプロセスを管理する。

### agent

nomadは単一の実行ファイルで構成されている。  
この実行ファイルから、操作コマンドとagent起動を行える。

agentモードで起動されたnomadプロセスは、自身が管理する「ジョブ」という単位のプロセスに対して、管理を行う。

### job

docker-compose.ymlと同様に複数のプロセスを実行、管理するための設定書。  
このjob単位で起動・停止を行え、jobの状態を確認できる。

このjobの設定ファイル上では、service,batch,systemなどタイプが指定でき、起動するjobの性質に応じた管理が行える。

### cluster

agentをサーバモードで起動して、クライアントを構成するとクラスタを組むことができる。  
server単体だと特に何もしなさそう。  
clientがjobを実行するagentになる。

※ はまった点

Windowsで `-dev` つけずに実行するとフィンガープリントでこけた。  
イシュー漁ったら、インタフェースのローカライズのせいでうんたらかんたらと書いてあった。  
自力でインタフェース指定すればよいと記載を発見（そのイシューの後ろで対応したぜって言っていそうなのだが。。。）  
とりあえずデフォルトインタフェースを直接指定したらうまくいった。

### ui

agentを起動していると、 `http://localhost:4646` でWeb UIが立ち上がっている。  
ここから、server,client,jobの状態を参照することができる。

### ここで気づいた

サンプルのredisが動いているのか確認しようとしたところ、どうやら動いていないことが分かった。

原因としては、nomadのdocker driverがdockerを認識できていない様子。  
これ、Docker for Windowsに対応していなさそうな記述を見つけたのでそれが原因？

どうやっても動かないのでここでいったん断念

また、時間を見つけて試してみたい。
